<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fantasy MMA Leaderboard</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 40px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h1>Fantasy MMA â€“ 2025 Season</h1>

  <h2>Team Leaderboard</h2>
  <table id="team-table">
    <thead>
      <tr><th>Team</th><th>Total Points</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Fighter Points</h2>
  <table id="fighter-table">
    <thead>
      <tr><th>Team</th><th>Fighter</th><th>Roster Slot</th><th>Points</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // Replace with your own Supabase URL and anon key
    const SUPABASE_URL = "https://hbhbwuijvbkenncwtbfw.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhiaGJ3dWlqdmJrZW5uY3d0YmZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyOTg5NzksImV4cCI6MjA4Mjg3NDk3OX0.YwKDkbODTXNbQySb8O41MFH1C4dTKnGQ1jZqn3_-orM";

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function loadData() {
      // Load team leaderboard
      const { data: teams, error: teamError } = await supabase
        .from('season_team_summary')
        .select('*')
        .order('team_points', { ascending: false });

      if (teamError) {
        console.error(teamError);
        return;
      }

      const teamTbody = document.querySelector('#team-table tbody');
      teamTbody.innerHTML = '';
      teams.forEach(team => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${team.team_name}</td><td>${team.team_points}</td>`;
        teamTbody.appendChild(tr);
      });

      // Load fighter points
      const { data: fighters, error: fighterError } = await supabase
        .from('season_fighter_summary')
        .select('*');

      if (fighterError) {
        console.error(fighterError);
        return;
      }

      // Sort fighters: highest points first, utility at bottom
      fighters.sort((a,b) => {
        if (a.roster_slot.includes("Utility") && !b.roster_slot.includes("Utility")) return 1;
        if (!a.roster_slot.includes("Utility") && b.roster_slot.includes("Utility")) return -1;
        return b.points_total - a.points_total;
      });

      const fighterTbody = document.querySelector('#fighter-table tbody');
      fighterTbody.innerHTML = '';
      fighters.forEach(f => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${f.team_name}</td><td>${f.fighter_name}</td><td>${f.roster_slot}</td><td>${f.points_total}</td>`;
        fighterTbody.appendChild(tr);
      });
    }

    loadData();

    // Optional: refresh every 30 seconds
    setInterval(loadData, 30000);
  </script>
</body>
</html>
