<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fantasy MMA – 2025 Season</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
  th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; }
  th { background-color: #eee; }
  a { text-decoration: none; color: blue; }
</style>
</head>
<body>

<h1>Fantasy MMA – 2025 Season</h1>

<h2>Team Leaderboard</h2>
<table id="teamLeaderboard">
  <thead><tr><th>Team</th><th>Total Points</th></tr></thead>
  <tbody></tbody>
</table>

<h2>All Fighters by Points</h2>
<table id="allFighters">
  <thead><tr><th>Fighter</th><th>Team</th><th>Division</th><th>Points</th></tr></thead>
  <tbody></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const supabaseClient = supabase.createClient("https://hbhbwuijvbkenncwtbfw.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhiaGJ3dWlqdmJrZW5uY3d0YmZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyOTg5NzksImV4cCI6MjA4Mjg3NDk3OX0.YwKDkbODTXNbQySb8O41MFH1C4dTKnGQ1jZqn3_-orM");

async function loadMainPage() {
  const { data: fighters, error } = await supabaseClient.from('fighter_points_2025').select('*');
  if (error) return console.error(error);

  // --- TEAM LEADERBOARD ---
  const teamTotals = {};
  fighters.forEach(f => teamTotals[f.team_name] = (teamTotals[f.team_name]||0)+parseFloat(f.points_total));
  const tbody = document.querySelector("#teamLeaderboard tbody");
  tbody.innerHTML = "";
  Object.entries(teamTotals)
    .sort((a,b)=>b[1]-a[1])
    .forEach(([team, points])=>{
      tbody.innerHTML += `<tr>
        <td><a href="teams/${team.toLowerCase()}.html">${team}</a></td>
        <td>${points.toFixed(2)}</td>
      </tr>`;
    });

  // --- ALL FIGHTERS BY POINTS ---
  const fightersTbody = document.querySelector("#allFighters tbody");
  fightersTbody.innerHTML = "";
  fighters.sort((a,b)=>b.points_total - a.points_total).forEach(f=>{
    fightersTbody.innerHTML += `<tr>
      <td>${f.fighter_name}</td>
      <td>${f.team_name}</td>
      <td>${f.roster_slot}</td>
      <td>${parseFloat(f.points_total).toFixed(2)}</td>
    </tr>`;
  });
}

loadMainPage();
</script>
</body>
</html>
